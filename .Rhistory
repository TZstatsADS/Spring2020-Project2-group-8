yy
x[2,]->yy
yy
yy%>%unnest
yy%>%unnest(crime_data)
yy%>%unnest(crime_data)%>%unnest(sale_info_in_this_address)
yy%>%unnest()
yy%>%unnest(all)
yy%>%unnest(everything)
yy%>%unnest(everything())
Nested_dataset_house_crime_dis_less_800m
Nested_dataset_house_crime_dis_less_800m%>%head(2)
Nested_dataset_house_crime_dis_less_800m%>%head(2)%>%unnest(crime_data)%>%head(10)
Nested_dataset_house_crime_dis_less_800m%>%head(2)%>%unnest(sale_info_in_this_address)%>%head(10)
(Nested_dataset_house_crime_dis_less_800m[2,])%>%unnest(sale_info_in_this_address)%>%head(10)
(Nested_dataset_house_crime_dis_less_800m[2,])%>%unnest(crime_data)%>%head(10)
(Nested_dataset_house_crime_dis_less_800m[2,])
(Nested_dataset_house_crime_dis_less_800m%>%head(5))
(Nested_dataset_house_crime_dis_less_800m[2,])%>%unnest(crime_data)%>%head(10)
(Nested_dataset_house_crime_dis_less_800m[2,])%>%unnest(sale_info_in_this_address)%>%head(10)
housing_nest<- housing%>%group_by(ADDRESS)%>%nest(sale_info_in_this_address=-c(ADDRESS,Latitude,Longitude))%>%ungroup()
hou_nest<-housing_nest%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
cri<-crime_mahattan%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
cla=cri$crime_Latitude
clo=cri$crime_Longitude
m<-length(cla)
index<-NULL
for(i in 1:n){
crime_number=0
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(clo[j],cla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  crime_number<-crime_number+1
}
index<-rbind(index,tibble(house_id=i,crime_number=crime_number))
}
housing_nest<- housing%>%group_by(ADDRESS)%>%nest(sale_info_in_this_address=-c(ADDRESS,Latitude,Longitude))%>%ungroup()%>%head(5)
hou_nest<-housing_nest%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%head(5)
cri<-crime_mahattan%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")%>%head(500)
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
cla=cri$crime_Latitude
clo=cri$crime_Longitude
m<-length(cla)
index<-NULL
for(i in 1:n){
crime_number=0
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(clo[j],cla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  crime_number<-crime_number+1
}
index<-rbind(index,tibble(house_id=i,crime_number=crime_number))
}
index
index%>%right_join(hou_nest)
housing_nest<- housing%>%group_by(ADDRESS)%>%nest(sale_info_in_this_address=-c(ADDRESS,Latitude,Longitude))%>%ungroup()
hou_nest<-housing_nest%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
cri<-crime_mahattan%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
cla=cri$crime_Latitude
clo=cri$crime_Longitude
m<-length(cla)
index<-NULL
for(i in 1:n){
crime_amount=0
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(clo[j],cla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  crime_amount<-crime_amount+1
}
index<-rbind(index,tibble(house_id=i,crime_amount=crime_amount))
}
Nested_dataset_house_crime_amount_dis_less_800m<-index%>%right_join(hou_nest)
save(Nested_dataset_house_crime_amount_dis_less_800m,file = "Nested_dataset_house_crime_amount_dis_less_800m.RData")
n1<-Sys.time()
housing_nest<- housing%>%group_by(ADDRESS)%>%nest(sale_info_in_this_address=-c(ADDRESS,Latitude,Longitude))%>%ungroup()
hou_nest<-housing_nest%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
cri<-crime_mahattan%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
cla=cri$crime_Latitude
clo=cri$crime_Longitude
m<-length(cla)
index<-NULL
for(i in 1:n){
crime_amount=0
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(clo[j],cla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  crime_amount<-crime_amount+1
}
index<-rbind(index,tibble(house_id=i,crime_amount=crime_amount))
}
Nested_dataset_house_crime_amount_dis_less_800m<-index%>%right_join(hou_nest)
n2<-Sys.time()-n1
n2
save(Nested_dataset_house_crime_amount_dis_less_800m,file = "Nested_dataset_house_crime_amount_dis_less_800m.RData")
Nested_dataset_house_crime_amount_dis_less_800m
Nested_dataset_house_crime_amount_dis_less_800m[2,]%>%unnest
View(housing)
load("C:/Users/jiaoh/OneDrive/桌面/crime-mahattan-geo-info.RData")
crime_mahattan_geo_info
cri<-crime_mahattan_geo_info%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
cri
housing_nest<- housing%>%group_by(ADDRESS)%>%nest(sale_info_in_this_address=-c(ADDRESS,Latitude,Longitude))%>%ungroup()
housing_nest
housing_nest<- housing%>%select(c(ADDRESS,Latitude,Longitude))
housing_nest
hou_nest<-housing_nest%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hou_nest
hou_nest<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
cri<-crime_mahattan_geo_info%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
hou_nest
cri
cri
n1<-Sys.time()
hou_nest<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
cri<-crime_mahattan_geo_info%>%mutate(crime_id=row_number())%>%rename("crime_Longitude"="Longitude","crime_Latitude"="Latitude")
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
cla=cri$crime_Latitude
clo=cri$crime_Longitude
m<-length(cla)
index<-NULL
for(i in 1:n){
crime_amount=0
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(clo[j],cla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  crime_amount<-crime_amount+1
}
index<-rbind(index,tibble(house_id=i,crime_amount=crime_amount))
}
Nested_dataset_house_crime_amount_dis_less_800m<-index%>%right_join(hou_nest)
n2<-Sys.time()-n1
n2
Nested_dataset_house_crime_amount_dis_less_800m
save(Nested_dataset_house_crime_amount_dis_less_800m,file = "Nested_dataset_house_crime_amount_dis_less_800m.RData")
Nested_dataset_house_crime_amount_dis_less_800m%>%arrange(ADDRESS)
load("C:/Users/jiaoh/OneDrive/桌面/crime-mahattan-geo-info.RData")
load("C:/Users/jiaoh/OneDrive/桌面/housing.RData")
crime_mahattan_geo_info
housing
hou_nest<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hou_nest
hou_nest%>%unique()
hou_nest<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hou_nest
load("C:/Users/jiaoh/OneDrive/桌面/restaurant.RData")
newdata
newdata%>%names
View(newdata)
newdata$CAMIS%>%unique%>%length
newdata%>%arrange(CAMIS)
newdata%>%arrange(CAMIS)%>%head(10)
# This file is more than 100 MB, please download (url given in readme) and load it by yourself.
location_raw <- read_csv("C:/Users/jiaoh/OneDrive/桌面/NY Restaurant Location.csv")
```{r setup, include=FALSE}
library(tidyverse)
menu_raw <-read_csv("../data/MenuStat.csv")
# This file is more than 100 MB, please download (url given in readme) and load it by yourself.
location_raw <- read_csv("C:/Users/jiaoh/OneDrive/桌面/NY Restaurant Location.csv")
# Delete nutrition_text and nutrition_100g col, potassium col (since only 5k entry have value)
menu<-menu_raw[,-c(19,24:45)]
# Nested menu information
menu_info<-menu%>%group_by(restaurant)%>%nest()%>%rename(menu=data)
# Restaurant name from "menu"
menu_name<-menu%>%group_by(restaurant)%>%summarise(n=n())%>%arrange(desc(n))
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,BORO:ZIPCODE,`INSPECTION DATE`,Latitude,Longitude)%>%
unique%>%top_n(1,`INSPECTION DATE`)
x.
x
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,BORO:ZIPCODE,`INSPECTION DATE`,Latitude,Longitude,GRADE)%>%
unique%>%top_n(1,`INSPECTION DATE`)
x
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,BORO:ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)
x
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-`INSPECTION DATE`)
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))
x
# Restaurant location
x<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,DBA,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))
x
newdata<-x
restaurant<-x
save(restaurant,file = "restaurant.RData")
load("C:/Users/jiaoh/OneDrive/桌面/restaurant.RData")
load("C:/Users/jiaoh/OneDrive/桌面/housing.RData")
housing
restaurant
restaurant<-restaurant%>%uungroup()
restaurant<-restaurant%>%ungroup()
# This file is more than 100 MB, please download (url given in readme) and load it by yourself.
location_raw <- read_csv("C:/Users/jiaoh/OneDrive/桌面/NY Restaurant Location.csv")
restaurant<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,DBA,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))%>%ungroup()
restaurant
restaurant$GRADE%>%unique()
restaurant_unique<-location_raw%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,DBA,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))%>%ungroup()
save(restaurant_unique,file = "restaurant_unique.RData")
library(geosphere)
library(tibble)
hous<-housing%>%na.omit()
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
dist
library(geosphere)
library(tibble)
hous<-housing%>%na.omit()
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
for(i in 1:n){
vec<-c()
for(j in 1:m){
vec[j]<-distHaversine(c(hous$Longitude[i],hous$Latitude[i]),
c(restaurant$Longitude[j],restaurant$Latitude[j]), r=6378137)
}
dist[i,]<-vec
}
save(dist, file="restaurantdist.RData")
housing
restaurant$CAMIS%>%unique()%>%length
restaurant_unique%>%arrange(CAMIS)
save(restaurant_unique,file = "restaurant_unique")
save(restaurant_unique, file="../output/parkdist.RData")
setwd("~/GitHub/Spring2020-Project2-group-8")
save(restaurant_unique, file="../output/parkdist.RData")
save(restaurant_unique, file="./output/parkdist.RData")
save(restaurant_unique, file="../output/parkdist.RData")
save(restaurant_unique, file="../parkdist.RData")
setwd("~/GitHub/Spring2020-Project2-group-8")
save(restaurant_unique, file="../parkdist.RData")
save(restaurant_unique, file="parkdist.RData")
save(restaurant_unique, file="parkdist.RData")
restaurant_unique
View(restaurant_unique)
# location_raw <- read_csv("xxx/DOHMH_New_York_City_Restaurant_Inspection_Results.csv")
#
restaurant_unique<-location_raw%>%filter(BORO=="Manhattan")%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,DBA,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))%>%ungroup()
save(restaurant_unique,file = "restaurant_unique.RData")
View(restaurant_unique)
save(restaurant_unique,file = "restaurant_unique.RData")
restaurant_unique_manhattan<-location_raw%>%filter(BORO=="Manhattan")%>%group_by(CAMIS)%>%arrange(desc(`INSPECTION DATE`))%>%
select(CAMIS,DBA,BORO,ZIPCODE,`INSPECTION DATE`,GRADE,Latitude,Longitude,`CUISINE DESCRIPTION`)%>%
unique%>%top_n(1,`INSPECTION DATE`)%>%select(-c(`INSPECTION DATE`))%>%ungroup()
save(restaurant_unique_manhattan,file = "restaurant_unique_manhattan.RData")
hou_nest<-housing%>%na.omit()%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hou_nest
rest<-restaurant_unique_manhattan%>%mutate(crime_id=row_number())%>%rename("rest_Longitude"="Longitude","rest_Latitude"="Latitude")
rest
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
rla=rest$rest_Latitude
rlo=rest$rest_Longitude
m<-length(rla)
rest$GRADE%>%unique()
grade<-rest$GRADE%>%unique()
rest_grade<-rest$GRADE
rest_grade
grade
detect_index(NA,grade)
detect_index("A",grade)
detect_index(grade,"A")
detect_index(grade,~.x=="A")
detect_index(grade,~.x==NA)
sort(grade)
sort(grade,na.last = )
sort(grade,na.last =T)
grade<-rest$GRADE%>%unique()%>%sort(na.last =T)
grade
detect_index(grade,~.x==NA)
detect_index(grade,is.na)
grade_count=rep(0,7)
name(grade_count)<-grade
grade_count=rep(0,7)
names(grade_count)<-grade
grade_count
tibble(i=1,rest_stat=grade_count)
tibble(i=1,rest_stat=as_tibble(grade_count))
as_tibble(grade_count)
tibble(grade)
tibble(grade=rep(0,7))
tibble(0,0,0,0,0,0,0)
tibble(0,0,0,0,0,0,0,.name_repair = T)
tibble(0,0,0,0,0,0,0,.name_repair = unique\)
tibble(0,0,0,0,0,0,0,.name_repair = unique)
grade
grade_count=tibble(A=0,B=0,C=0,N=0,P=0,Z=0,NA=0)
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
grade_count
grade[1]
grade[2]
grade[1,2]
grade_count[1]
grade_count[2]
grade_count[2]<-grade_count[2]+1
grade_count
hou_nest<-housing%>%na.omit()%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%head(50)
rest<-restaurant_unique_manhattan%>%mutate(crime_id=row_number())%>%rename("rest_Longitude"="Longitude","rest_Latitude"="Latitude")%>%head(50)
grade<-rest$GRADE%>%unique()%>%sort(na.last =T)
rest_grade<-rest$GRADE
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
rla=rest$rest_Latitude
rlo=rest$rest_Longitude
m<-length(rla)
index<-NULL
for(i in 1:n){
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(rlo[j],rla[j]),r=6378137)
if(!is.na(dist))if(dist<8000)  {
ifelse(is.na(rest_grade[j]),grade_count[7]=grade_count[7]+1,grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1)
grade_count
grade_count[7]
grade_count[7]=grade_count[7]+1
j=1
ifelse(T,grade_count[7]<-grade_count[7]+1,grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1)
ifelse(T,grade_count[7]<-grade_count[7]+1,grade_count[detect_index(grade,rest_grade[j])]<-grade_count[detect_index(grade,rest_grade[j])]+1)
hou_nest<-housing%>%na.omit()%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%head(50)
rest<-restaurant_unique_manhattan%>%mutate(crime_id=row_number())%>%rename("rest_Longitude"="Longitude","rest_Latitude"="Latitude")%>%head(50)
grade<-rest$GRADE%>%unique()%>%sort(na.last =T)
rest_grade<-rest$GRADE
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
rla=rest$rest_Latitude
rlo=rest$rest_Longitude
m<-length(rla)
index<-NULL
for(i in 1:n){
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(rlo[j],rla[j]),r=6378137)
if(!is.na(dist))if(dist<8000)  {
if(is.na(rest_grade[j]))grade_count[7]<-grade_count[7]+1
else grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1
}
}
index<-rbind(index,cbind(tibble(house_id=i),grade_count))
}
ifelse(T,grade_count[7]<-grade_count[7]+1,grade_count[detect_index(grade,rest_grade[j])]<-grade_count[detect_index(grade,rest_grade[j])]+1)
rest_grade
is.na(rest_grade[j])
j
i=1
j=1
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
dist<-distHaversine(c(hlo[i],hla[i]),c(rlo[j],rla[j]),r=6378137)
!is.na(dist)
dist<8000
if(is.na(rest_grade[j]))grade_count[7]<-grade_count[7]+1
else grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1
else {grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1}
if(is.na(rest_grade[j]))grade_count[7]<-grade_count[7]+1
else {grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1}
if(is.na(rest_grade[j])){grade_count[7]<-grade_count[7]+1}
else {grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1}
dist
rest_grade[j]
is.na(rest_grade[j])
grade_count[detect_index(grade,rest_grade[j])]=grade_count[detect_index(grade,rest_grade[j])]+1
grade_count[detect_index(grade,~.x==rest_grade[j])]=grade_count[detect_index(grade,~.x==rest_grade[j])]+1
hou_nest<-housing%>%na.omit()%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%head(50)
rest<-restaurant_unique_manhattan%>%mutate(crime_id=row_number())%>%rename("rest_Longitude"="Longitude","rest_Latitude"="Latitude")%>%head(50)
grade<-rest$GRADE%>%unique()%>%sort(na.last =T)
rest_grade<-rest$GRADE
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
rla=rest$rest_Latitude
rlo=rest$rest_Longitude
m<-length(rla)
index<-NULL
for(i in 1:n){
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(rlo[j],rla[j]),r=6378137)
if(!is.na(dist))if(dist<8000)  {
if(is.na(rest_grade[j])){grade_count[7]<-grade_count[7]+1}
else {grade_count[detect_index(grade,~.x==rest_grade[j])]=grade_count[detect_index(grade,~.x==rest_grade[j])]+1}
}
}
index<-rbind(index,cbind(tibble(house_id=i),grade_count))
}
# Nested_dataset_house_crime_amount_dis_less_800m<-index%>%right_join(hou_nest)
index
hou_nest<-housing%>%na.omit()%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
rest<-restaurant_unique_manhattan%>%mutate(crime_id=row_number())%>%rename("rest_Longitude"="Longitude","rest_Latitude"="Latitude")
grade<-rest$GRADE%>%unique()%>%sort(na.last =T)
rest_grade<-rest$GRADE
hla=hou_nest$house_Latitude
hlo=hou_nest$house_Longitude
n=length(hla)
rla=rest$rest_Latitude
rlo=rest$rest_Longitude
m<-length(rla)
index<-NULL
for(i in 1:n){
grade_count<-tibble(A=0,B=0,C=0,N=0,P=0,Z=0,"NA"=0)
for(j in 1:m){
dist<-distHaversine(c(hlo[i],hla[i]),c(rlo[j],rla[j]),r=6378137)
if(!is.na(dist))if(dist<800)  {
if(is.na(rest_grade[j])){grade_count[7]<-grade_count[7]+1}
else {grade_count[detect_index(grade,~.x==rest_grade[j])]=grade_count[detect_index(grade,~.x==rest_grade[j])]+1}
}
}
index<-rbind(index,cbind(tibble(house_id=i),grade_count))
}
Nested_dataset_house_rest_grade_amount_dis_less_800m<-index%>%right_join(hou_nest)
Nested_dataset_house_rest_grade_amount_dis_less_800m
Nested_dataset_house_rest_grade_amount_dis_less_800m<-index%>%right_join(hou_nest)%>%rename(grade_A="A",grade_B="B",grade_C="C",grade_N="N",grade_P="P",grade_Z="Z",grade_NA="NA")
v
Nested_dataset_house_rest_grade_amount_dis_less_800m
Nested_dataset_house_rest_grade_amount_dis_less_800m<-index%>%right_join(hou_nest)%>%rename(grade_A="A",grade_B="B",grade_C="C",grade_N="N",grade_P="P",grade_Z="Z",grade_NA="NA")%>%as_tibble()
Nested_dataset_house_rest_grade_amount_dis_less_800m
save(Nested_dataset_house_rest_grade_amount_dis_less_800m, file="Nested_dataset_house_rest_grade_amount_dis_less_800m.RData")
hous
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%na.omit()
hous
housing
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hous
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")%>%na.omit()
hous
hou_nest<-
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
hous
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
for(i in 1:1){
vec<-c()
for(j in 1:m){
vec[j]<-distHaversine(c(hous$Longitude[i],hous$Latitude[i]),
c(restaurant$Longitude[j],restaurant$Latitude[j]), r=6378137)
}
dist[i,]<-vec
}
i=1
j=1
vec<-c()
vec[j]<-distHaversine(c(hous$Longitude[i],hous$Latitude[i]),
c(restaurant$Longitude[j],restaurant$Latitude[j]), r=6378137)
hou_nest<-
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())#%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
for(i in 1:1){
vec<-c()
for(j in 1:m){
vec[j]<-distHaversine(c(hous$Longitude[i],hous$Latitude[i]),
c(restaurant$Longitude[j],restaurant$Latitude[j]), r=6378137)
}
dist[i,]<-vec
}
dist
hou_nest<-
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%na.omit()#%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
hous<-housing%>%select(c(ADDRESS,Latitude,Longitude))%>%unique%>%mutate(house_id=row_number())%>%na.omit()#%>%rename("house_Longitude"="Longitude","house_Latitude"="Latitude")
n<-nrow(hous)
m<-nrow(restaurant)
dist<-matrix(,nrow=n,ncol=m)
n1<-Sys.time()
for(i in 1:n){
vec<-c()
for(j in 1:m){
vec[j]<-distHaversine(c(hous$Longitude[i],hous$Latitude[i]),
c(restaurant$Longitude[j],restaurant$Latitude[j]), r=6378137)
}
dist[i,]<-vec
}
n2<-Sys.time()-n1
n2
save(dist, file="restaurantdist.RData")
Nested_dataset_house_rest_grade_amount_dis_less_800m
View(dist)
dist[1,1]
dist[1,4]
dim(dist)
